<% expands('layout/base') %>

<% start('main') %>
<div class="container">
	<form class="form-signin" id="loginform">
		<h2 class="form-signin-heading">Login</h2>
		<div id="error"></div>
		<div class="control-group"><input type="text" class="input-block-level" placeholder="Username" name="username"></div>
		<div class="control-group"><input type="password" class="input-block-level" placeholder="Password" name="password"></div>
		<button class="btn btn-large btn-primary" type="submit" id="login">Log in</button>
	</form>
</div>
<style type="text/css">
	body {
		padding-top: 40px;
		padding-bottom: 40px;
		background-color: #f5f5f5;
	}

	.form-signin {
		max-width: 300px;
		padding: 19px 29px 29px;
		margin: 0 auto 20px;
		background-color: #fff;
		border: 1px solid #e5e5e5;
		-webkit-border-radius: 5px;
			 -moz-border-radius: 5px;
						border-radius: 5px;
		-webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
			 -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
						box-shadow: 0 1px 2px rgba(0,0,0,.05);
	}
	.form-signin .form-signin-heading,
	.form-signin .checkbox {
		margin-bottom: 10px;
	}
	.form-signin input[type="text"],
	.form-signin input[type="password"] {
		font-size: 16px;
		height: auto;
		margin-bottom: 15px;
		padding: 7px 9px;
	}
</style>
<script>
	$('#login').click(function(e) {
		e.preventDefault();
		var loginData = $('#loginform').jsonify();
		$('#error').html('');
		$('.control-group').removeClass('error');
		
		$.post('/login', loginData, function(data) {
			if (data.error) {
				$('#error').html('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Warning!</strong> Login failed!</div>');
				for (var input in data.errors.errors) {
					$('[name="' + input + '"]').parent().addClass('error');
				}
			} else if (data.redirect) {
				window.location = data.redirect;
			}
		});
	});
</script>
<% end('main') %>